<div ng-controller="ClassificationPluginCtrl"
     class="error-classification-content">
  <ul class="list-unstyled failure-line-list">

    <li ng-repeat="line in failureLines"
        class="failure-line"
        ng-class="{'classified-line': line.best_classification }">
      <button ng-if="!line.best_is_verified"
              class="btn btn-xs btn-default"
              title="Requires verification - select best match and click here"
              ng-click="verifyBest($index)">Verify</button>
      <span ng-if="line.best_is_verified"
              class="label label-xs label-primary"
              title="This classification is already verified">Verified</span>
      <span><strong>{{line | classified}}</strong></span>
      <span ng-if="line.action === 'test_result'">
        <span>{{line.test}} {{line.subtest}}
          Expected: {{line.expected}}, got: <strong>{{line.status}}</strong>
        </span>
        <div ng-if="line.message"
             ng-init="messageExpanded=false"
             class="failure-line-message">
             <span class="failure-line-message-toggle fa fa-fw fa-lg"
                     ng-class="{'fa-caret-down': messageExpanded, 'fa-caret-right': !messageExpanded}"
                     ng-click="messageExpanded = !messageExpanded"></span>
             <span ng-if="!messageExpanded"
                   class="failure-line-message-collapsed">{{ line.message }}</span>
             <span ng-if="messageExpanded"
                   class="failure-line-message-expanded">{{ line.message }}</span>
        </div>
      </span>
      <span ng-if="line.action === 'log'">
        LOG {{line.level}} | {{line.message}}
      </span>
      <span ng-if="line.action === 'crash'">
        CRASH | {{line.signature}}
      </span>
      <span ng-if="line.action === ''">
        CRASH | {{line.signature}}
      </span>

      <span ng-if="line.classified_failures.length">
        <ul class="list-unstyled classification-options">
          <!--classifications for line-->
          <li ng-repeat="classification in lineClassificationOptions[line.id]" >
            <label>
              <input type="radio"
                     value="{{classification.id}}"
                     name="{{::line.id}}"
                     ng-model="lineBest[line.id]" />
                <a href="{{::getBugUrl(classification.bug_number) }}"
                   ng-if="classification.bug_number"
                   target="_blank">{{::classification.bug_number}}
                  <span ng-bind-html="classification.bug_summary | escapeHTML"></span>
                </a>

                <!--enter bug manually-->
                <span ng-if="classification.id === 'manual'">
                  <input ng-if="lineBest[line.id] === 'manual'"
                         class="manual-bug-input"
                         type="text"
                         ng-model="manualBugs[line.id]"/>
                  <span ng-if="lineBest[line.id] !== 'manual'"
                        class="manual-bug-label lightgray"><em>Enter a bug number</em></span>
                </span>
            </label>
          </li>
        </ul>
      </span>
    </li>

    <li ng-if="!tabs.autoClassification.is_loading &&  !failureLines.length">
      <span>No classifiable errors for this job.</span>
    </li>
  </ul>
</div>
